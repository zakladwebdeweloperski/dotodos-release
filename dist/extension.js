(()=>{var t={12(t,e,n){const o=n(398),i="dotodos",r="dotodos",s="☑",a="☐";function c(){const t=o.window.activeTextEditor;return t&&t.document.languageId===r?t:(o.window.showErrorMessage(`Please open a .${r} file first`),!1)}function d(){try{const i=c();if(!i)return;const r=i.document,d=[],l=[],u=new Set;function t(t){return t.startsWith(a)||t.startsWith(s)}function e(t){return t.endsWith(":")||t.includes(":")&&t.includes("(")&&t.endsWith(")")}function n(n){const o=[],i=r.lineAt(n),s=i.text.substring(0,i.firstNonWhitespaceCharacterIndex).length;for(let i=n+1;i<r.lineCount;i++){const n=r.lineAt(i),a=n.text.trim(),c=n.text.substring(0,n.firstNonWhitespaceCharacterIndex).length;if(""!==a){if(t(a)&&c<=s)break;if(e(a))break;if(t(a)&&c>s)break;o.push(i)}else o.push(i)}return o}for(let g=0;g<r.lineCount;g++){if(u.has(g))continue;const m=r.lineAt(g);if(m.text.trim().startsWith(s)){l.push(m.text),u.add(g);const x=n(g);for(const p of x)l.push(r.lineAt(p).text),u.add(p)}}if(0===l.length)return void o.window.showInformationMessage("No done tasks to archive");for(let w=0;w<r.lineCount;w++)u.has(w)||d.push(r.lineAt(w).text);let h=!1;for(let C of d)if(C.trim().startsWith("Archived:")){h=!0;break}h||d.push("","Archived:"),d.push(...l);const f=d.join("\n");i.edit(t=>{t.replace(new o.Range(0,0,r.lineCount,0),f)})}catch(W){o.window.showErrorMessage(`Failed to archive done tasks: ${W.message}`),console.error("Archive done error:",W)}}t.exports={activate:function(t){const e={markAsTask:o.commands.registerCommand(`${i}.markAsTask`,function(){try{const t=c();if(!t)return!1;const e=t.document,n=t.selection.active.line,i=e.lineAt(n),r=i.text.trim(),d=i.firstNonWhitespaceCharacterIndex;if(r.startsWith(a)||r.startsWith(s)){const e=new o.Position(n,d),i=new o.Position(n,d+a.length+1);return void t.edit(t=>{t.delete(new o.Range(e,i))})}const l=new o.Position(n,i.firstNonWhitespaceCharacterIndex);t.edit(t=>{t.insert(l,`${a} `)})}catch(t){o.window.showErrorMessage(`Failed to mark as task: ${t.message}`),console.error("Mark as task error:",t)}}),toggleTaskState:o.commands.registerCommand(`${i}.toggleTaskState`,function(){try{const t=c();if(!t)return!1;const e=t.document,n=t.selection.active.line,o=e.lineAt(n),i=o.text,r=i.substring(0,o.firstNonWhitespaceCharacterIndex),d=i.trim();if(d.startsWith(a)){const i=new Date,c=` @${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:${String(i.getMinutes()).padStart(2,"0")}:${String(i.getSeconds()).padStart(2,"0")}`,l=d.slice(a.length+1),u=`${r}${s} ${l}${c}`;t.edit(t=>{t.replace(o.range,u);const i=r.length;for(let o=n+1;o<e.lineCount;o++){const n=e.lineAt(o),r=n.text,d=r.trim();if(""!==d){if(r.substring(0,n.firstNonWhitespaceCharacterIndex).length<=i)break;if(d.startsWith(a)){const e=r.substring(0,n.firstNonWhitespaceCharacterIndex),o=d.slice(a.length+1),i=`${e}${s} ${o}${c}`;t.replace(n.range,i)}}}})}else if(d.startsWith(s)){let i=d.slice(s.length+1);i=i.replace(/ @\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/,"");const c=`${r}${a} ${i}`;t.edit(t=>{t.replace(o.range,c);const i=r.length;for(let o=n+1;o<e.lineCount;o++){const n=e.lineAt(o),r=n.text,c=r.trim();if(""!==c){if(r.substring(0,n.firstNonWhitespaceCharacterIndex).length<=i)break;if(c.startsWith(s)){const e=r.substring(0,n.firstNonWhitespaceCharacterIndex);let o=c.slice(s.length+1);o=o.replace(/ @\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/,"");const i=`${e}${a} ${o}`;t.replace(n.range,i)}}}})}}catch(t){o.window.showErrorMessage(`Failed to toggle task state: ${t.message}`),console.error("Toggle task state error:",t)}}),archiveDone:o.commands.registerCommand(`${i}.archiveDone`,d),indentTask:o.commands.registerCommand(`${i}.indentTask`,function(){try{const t=c();if(!t)return o.commands.executeCommand("default:type",{text:"\t"});const e=t.selection,n=e.start.line,i=e.end.line;if(n!==i)t.edit(e=>{for(let r=n;r<=i;r++){const n=t.document.lineAt(r).text.trim();(n.startsWith(a)||n.startsWith(s))&&e.insert(new o.Position(r,0),"\t")}}).then(()=>{const r=new o.Position(n,e.start.character+1),s=new o.Position(i,e.end.character+1);t.selection=new o.Selection(r,s)});else{const e=t.selection.active,n=e.line,i=t.document.lineAt(n).text.trim();if(!i.startsWith(a)&&!i.startsWith(s))return o.commands.executeCommand("default:type",{text:"\t"});t.edit(t=>{t.insert(new o.Position(n,0),"\t")}).then(()=>{const i=new o.Position(n,e.character+1);t.selection=new o.Selection(i,i)})}}catch(t){o.window.showErrorMessage(`Failed to indent task: ${t.message}`),console.error("Indent task error:",t)}})};!function(t){let e=new Map,n=-1;const i=o.window.createTextEditorDecorationType({color:new o.ThemeColor("editor.foreground")}),c=o.window.createTextEditorDecorationType({color:new o.ThemeColor("editorLineNumber.foreground"),textDecoration:"line-through"}),d=o.window.createTextEditorDecorationType({after:{color:new o.ThemeColor("editorHint.foreground"),fontStyle:"italic",margin:"0 0 0 0.5em"}}),l=o.window.createTextEditorDecorationType({color:new o.ThemeColor("editorInfo.foreground"),fontWeight:"bold"}),u=o.window.createTextEditorDecorationType({after:{color:new o.ThemeColor("editorHint.foreground"),fontStyle:"normal",fontWeight:"normal"}});function h(t){if(!(t=t||o.window.activeTextEditor)||t.document.languageId!==r)return;var h;(h=t.document).version!==n&&(e.clear(),n=h.version);const m=[],C=[],W=[],$=[];for(let e=0;e<t.document.lineCount;e++){const n=t.document.lineAt(e),i=n.text.trim();if(i.startsWith(a)){const t=new o.Position(e,n.firstNonWhitespaceCharacterIndex),i=new o.Position(e,n.firstNonWhitespaceCharacterIndex+1);m.push(new o.Range(t,i))}else if(i.startsWith(s)){p(n,e,C);const o=x(t.document,e);for(const e of o){const n=t.document.lineAt(e);""!==n.text.trim()&&p(n,e,C)}}else if(f(i)){const r=g(i),s=new o.Position(e,n.firstNonWhitespaceCharacterIndex),a=new o.Position(e,n.text.length);W.push(new o.Range(s,a));const{doneCount:c,allCount:d}=w(t.document,e);let l;l="Archived"===r?` (${d})`:` (${c}/${d})`,$.push({range:new o.Range(e,n.text.length,e,n.text.length),renderOptions:{after:{contentText:l}}})}}t.setDecorations(i,m),t.setDecorations(c,C),t.setDecorations(l,W),t.setDecorations(u,$),t.setDecorations(d,[])}function f(t){return t.endsWith(":")||t.includes(":")&&t.includes("(")&&t.endsWith(")")}function g(t){return t.includes(": (")?t.substring(0,t.indexOf(": (")):t.slice(0,-1)}function m(t){return t.startsWith(a)||t.startsWith(s)}function x(t,n){const o=`${t.uri.toString()}_${n}`;if(e.has(o))return e.get(o);const i=[],r=t.lineAt(n),s=r.text.substring(0,r.firstNonWhitespaceCharacterIndex).length;for(let e=n+1;e<t.lineCount;e++){const n=t.lineAt(e),o=n.text.trim(),r=n.text.substring(0,n.firstNonWhitespaceCharacterIndex).length;if(""!==o){if(m(o)&&r<=s)break;if(f(o))break;if(m(o)&&r>s)break;i.push(e)}else i.push(e)}return e.set(o,i),i}function p(t,e,n){const i=t.text;let r=t.firstNonWhitespaceCharacterIndex;for(;r<i.length;){if(" "===i[r]||"\t"===i[r]){r++;continue}const t=r;for(;r<i.length&&" "!==i[r]&&"\t"!==i[r];)r++;n.push(new o.Range(e,t,e,r))}}function w(t,e){let n=0,o=0,i=t.lineCount;for(let n=e+1;n<t.lineCount;n++)if(f(t.lineAt(n).text.trim())){i=n;break}for(let r=e+1;r<i;r++){const e=t.lineAt(r).text.trim();e.startsWith(s)?n++:e.startsWith(a)&&o++}return{doneCount:n,todoCount:o,allCount:n+o}}t.subscriptions.push(i,c,l,u,d),t.subscriptions.push(o.window.onDidChangeActiveTextEditor(t=>{h(t)})),t.subscriptions.push(o.workspace.onDidChangeTextDocument(t=>{const e=o.window.activeTextEditor;e&&t.document===e.document&&e.document.languageId===r&&h(e)})),h()}(t);let n=null;const l=o.commands.registerCommand(`${i}.onEnter`,()=>{const t=o.window.activeTextEditor;if(!t||t.document.languageId!==r)return o.commands.executeCommand("default:type",{text:"\n"});const e=t.selection.active,i=t.document.lineAt(e.line),c=i.text,d=c.trim();if(n&&n.line===e.line&&n.text===c&&d===a){const e=c.substring(0,i.firstNonWhitespaceCharacterIndex);return t.edit(t=>{t.replace(i.range,e)}).then(()=>{o.commands.executeCommand("default:type",{text:"\n"})}),void(n=null)}if(!d.startsWith(a)&&!d.startsWith(s)||e.character!==c.length)return n=null,o.commands.executeCommand("default:type",{text:"\n"});{const r=`${c.substring(0,i.firstNonWhitespaceCharacterIndex)}${a} `;t.edit(t=>{t.insert(new o.Position(e.line,c.length),"\n"+r)}).then(()=>{const i=new o.Position(e.line+1,r.length);t.selection=new o.Selection(i,i),n={line:e.line+1,text:r}})}}),u=o.commands.registerCommand(`${i}.onBackspace`,()=>{const t=o.window.activeTextEditor;if(!t||t.document.languageId!==r)return o.commands.executeCommand("deleteLeft");const e=t.selection.active,i=t.document.lineAt(e.line),s=i.text,c=s.trim(),d=s.substring(0,i.firstNonWhitespaceCharacterIndex);if(!n||n.line!==e.line||c!==a||e.character!==d.length+a.length+1)return o.commands.executeCommand("deleteLeft");t.edit(t=>{t.replace(i.range,d)}).then(()=>{const n=new o.Position(e.line,d.length);t.selection=new o.Selection(n,n)}),n=null});t.subscriptions.push(l,u),t.subscriptions.push(...Object.values(e))},deactivate:function(){}}},398(t){"use strict";t.exports=require("vscode")}},e={},n=function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}(12);module.exports=n})();